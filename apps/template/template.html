<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>

    <!-- Import JQuery library -->
    <script src="http://%SYSIP%:8001/lib/jquery/jquery-1.11.1.min.js"></script>

    <!-- Import Foundation Frameworks -->
    <script src="http://%SYSIP%:8001/lib/framework/foundation/foundation.js"></script>

    <!-- Import UI Frameworks -->
    <script src="http://%SYSIP%:8001/lib/framework/ui/ui-kits.js"></script>

    <!-- Import Template style -->
    <link href="css/style.css" rel="stylesheet">

    <!-- Import extension module -->
    <script src="js/extension/example.js"></script>

    <script>
        /* TemplateViewController Constructor */
        function TemplateViewController() {
            this._super = CoreClient;
            this.delegate = this;
            this.extensionClient = new ExtensionClient();

            /* Create & implement example extension delegates */
            var exampleDelegate = new ExampleExtensionDelegate();

            exampleDelegate.exampleDidSayHello = function(msg) {
                $("#ext-response").html("Extension Response Test: <font color=blue>" + msg + "</font>");
            };

            exampleDelegate.exampleDidFailSayHelloWithError = function(err) {
                $("#ext-error").html("Extenstion Error Test: <font color=blue>" + err + "</font>");
            };

            /* Create client side example extension & install delegate */
            this.exampleExtension = new ExampleExtension();
            this.exampleExtension.delegate = exampleDelegate;
        };

        /* Inherit CoreClient */
        TemplateViewController.prototype = new CoreClient();
        TemplateViewController.prototype.constructor = TemplateViewController;

        extend(TemplateViewController.prototype, ExtensionDelegate.prototype);

        TemplateViewController.prototype.connectionDidEstablish = function() {
            this._super.prototype.connectionDidEstablish.call(this);
            this.extensionClient.register(this);
        };

        TemplateViewController.prototype.connectionDidClose = function() {
            /* Unload both client & server side extension module */
            this.extensionClient.unload(this.exampleExtension);
            this.extensionClient.unregister();
            this._super.prototype.connectionDidClose.call(this);
        };

        TemplateViewController.prototype.connectionDidFailWithError = function(error) {
            this._super.prototype.connectionDidFailWithError.call(this, error);

            $("#proto").html(
                "Protocol version <font color=blue>" + this.version + "</font> load failed, error = " + error
            );
        };

        /* Implement protocol delegates */
        TemplateViewController.prototype.protoDidLoadSpec = function() {
            this._super.prototype.protoDidLoadSpec.call(this);

            // NOTE: Do protocol relative operations here

            $("#proto").html(
                "Protocol major version: <font color=blue>" + this.version + "</font>"
            );

            /* Load both client & server side extension module */
            this.extensionClient.load(this.exampleExtension);
        };

        TemplateViewController.prototype.protoDidFailLoadSpecWithError = function(error) {
            this._super.prototype.protoDidFailLoadSpecWithError.call(this);
            // TODO: Do something on protocol spec load failed
        };

        /* Implement extension protocol delegates */
        TemplateViewController.prototype.extensionDidLoad = function(name) {
            $("#proto").html(
                $("#proto").html() +
                "<br>Extension protocol [" + name + "] major version: <font color=blue>" +
                this.exampleExtension.version + "</font>"
            );

            /* Test extension protocol */
            this.exampleExtension.sayHello("Bowie", "Kenny");
        };

        TemplateViewController.prototype.extensionDidUnload = function(name) {
            // TODO: Do something on extension unloaded
        };

        TemplateViewController.prototype.extensionDidFailLoadWithError = function(name, error) {
            alert('extensionDidFailLoadWithError');
            this._super.prototype.extensionDidFailLoadWithError.call(this, name, error);

            alert('Load extension ' + name + ' failed with error: ' + error);
            // TODO: Do something on extention load failed with error
        };

        TemplateViewController.prototype.extensionDidFailUnloadWithError = function(name, error) {
            this._super.prototype.extensionDidFailUnloadWithError.call(this, name, error);

            // TODO: Do something on extention unload failed with error
        };

        /* Implement protocol delegates you need */
        // TODO: Your codes here

        $(function() {
            var templateViewController = new TemplateViewController();
            templateViewController.initiate();
        });
    </script>
</head>
<body>
    <div id="wrapper">
        <div id="header"></div>
        <div id="content">

            <!-- TODO: Your codes here -->

            <h2>Hello Template</h2>
            <div id="proto"></div>
            <div id="ext-response"></div>
            <div id="ext-error"></div>
        </div>
        <div id="footer"></div>
    </div>

    <script>
        var page = new Page();
        page.setTitle("Template");
        page.createNavigationBar("Template");
        page.setFooterText("%COPYRIGHT%");

        var brandLabel = new NavigationBarLabel("%BRAND%");
        page.navigationBar.rightContainer.pushItem(brandLabel);
    </script>
</body>
</html>
